<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.dlufl.ohrigei.dao.AdminDao">
    <resultMap id="Delegate" type="edu.dlufl.ohrigei.model.Delegate">
        <result column="id" property="ID"/>
        <result column="name" property="name"/>
        <result column="enable_login" property="enable_Login"/>
        <result column="school_name" property="schoolName"/>
        <result column="application_type" property="applicationType"/>
        <result column="application_status_text" property="applicationStatus"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
    </resultMap>
    <resultMap id="Group" type="edu.dlufl.ohrigei.model.Group">
        <result column="id" property="id"/>
        <result column="school_ID" property="schoolID"/>
        <result column="school_name" property="schoolName"/>
        <result column="head_delegate_ID" property="headDelegateID"/>
        <result column="name" property="headDelegateName"/>
        <result column="group_size" property="groupSize"/>
    </resultMap>
    <resultMap id="Admin" type="edu.dlufl.ohrigei.model.Admin">
        <result column="name" property="name"/>
        <result column="title" property="title"/>
        <result column="role_AG" property="role_AG"/>
        <result column="role_AD" property="role_AD"/>
        <result column="role_D" property="role_D"/>
        <result column="role_F" property="role_F"/>
        <result column="role_L" property="role_L"/>
        <result column="role_SG" property="role_SG"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
        <result column="committee_name" property="committeeName"/>
    </resultMap>
    <resultMap id="Committee" type="edu.dlufl.ohrigei.model.Committee">
        <result column="name" property="name"/>
        <result column="seat_width" property="seatWidth"/>
        <result column="uname" property="chairManName"/>
    </resultMap>
    <resultMap id="School" type="edu.dlufl.ohrigei.model.School">
        <result column="id" property="id"/>
        <result column="school_name" property="schoolName"/>
        <result column="school_name_EN" property="schoolNameEN"/>
        <result column="school_type" property="schoolType"/>
        <result column="school_address" property="schoolAddress"/>
        <result column="size" property="size"/>
        <result column="club_ID" property="clubID"/>
    </resultMap>
    <select id="queryAllMember" resultMap="Delegate">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               ohrigei.user.enable_login,
               ohrigei.user.email,
               ohrigei.user.phone,
               ohrigei.school_info.school_name,
               ohrigei.application_type.application_type,
               ohrigei.application_status.application_status_text
        FROM ohrigei.delegate
                 left join user on delegate.id = ohrigei.user.id
                 left join `group` on delegate.group_ID = `group`.id
                 left join school_info on ohrigei.group.school_ID = school_info.id
                 left join application_type on application_type.id = delegate.application_type_ID
                 left join application_status on application_status.id = delegate.application_status_ID
        WHERE ohrigei.delegate.role_ID = #{type}
          AND `user`.role_ID = 2
    </select>
    <select id="queryAllGroup" resultMap="Group">
        SELECT `group`.id, school_ID, head_delegate_ID, group_size, school_name, name
        FROM `group`
                 LEFT JOIN delegate d on `group`.head_delegate_ID = d.id
                 LEFT JOIN user u on d.id = u.id
                 LEFT JOIN school_info si on `group`.school_ID = si.id
    </select>
    <select id="queryAllAdmin" resultMap="Admin">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               admin.title,
               ohrigei.committee.committee_name,
               ohrigei.admin.role_AG,
               ohrigei.admin.role_AD,
               ohrigei.admin.role_D,
               ohrigei.admin.role_F,
               ohrigei.admin.role_L,
               ohrigei.admin.role_SG
        from ohrigei.user
                 LEFT JOIN ohrigei.admin ON ohrigei.user.id = admin.id
                 LEFT JOIN ohrigei.committee ON ohrigei.admin.committee_ID = ohrigei.committee.id
        where role_ID = 1
    </select>
    <select id="queryAllCommittee" resultMap="Committee">
        SELECT committee.name, seat_width, ohrigei.user.name uname
        from committee,
             user
        where ohrigei.committee.chairman_ID
    </select>
    <select id="emailCheck" resultType="string">
        SELECT ohrigei.user.email
        from ohrigei.user
        where email = #{email}
    </select>
    <insert id="addAdminStep1" parameterType="edu.dlufl.ohrigei.model.Admin">
        insert into ohrigei.user(name, email, password, phone, role_ID)
        values (#{name}, #{email}, #{password}, #{phone}, 1)
    </insert>
    <select id="getInsertID" resultType="int">
        select ohrigei.user.id
        from ohrigei.user
        where email = #{email}
    </select>
    <insert id="addAdminStep2" parameterType="edu.dlufl.ohrigei.model.Admin">
        insert into ohrigei.admin(id, title, role_AG, role_AD, role_D, role_L, role_F, role_SG)
        VALUES (#{id}, #{title}, #{role_AG}, #{role_AD}, #{role_D}, #{role_L}, #{role_F}, #{role_SG})
    </insert>
    <select id="adminDetail" resultMap="Admin">
        SELECT ohrigei.user.name,
               admin.title,
               ohrigei.committee.committee_name,
               ohrigei.admin.role_AG,
               ohrigei.admin.role_AD,
               ohrigei.admin.role_D,
               ohrigei.admin.role_F,
               ohrigei.admin.role_L,
               ohrigei.admin.role_SG
        from ohrigei.user
                 LEFT JOIN ohrigei.admin ON ohrigei.user.id = admin.id
                 LEFT JOIN ohrigei.committee ON ohrigei.admin.committee_ID = ohrigei.committee.id
        where user.id = #{id}
    </select>
    <select id="countDelegate" resultType="int">
        SELECT count(*)
        from ohrigei.delegate
        where role_ID = #{roleId}
    </select>
    <select id="queryAllSchool" resultMap="School">
        SELECT school_info.id, school_name, school_name_EN, school_address, size, club_ID, school_type
        FROM school_info
                 LEFT JOIN school_type st on school_info.school_type_ID = st.id
        WHERE school_info.id NOT IN (SELECT school_ID FROM `group`)
    </select>
    <select id="queryMemberAbleToUse" resultMap="Delegate">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               ohrigei.user.email,
               ohrigei.user.phone,
               ohrigei.school_info.school_name,
               ohrigei.application_type.application_type,
               ohrigei.application_status.application_status_text
        FROM ohrigei.delegate
                 left join user on delegate.id = ohrigei.user.id
                 left join `group` on delegate.group_ID = `group`.id
                 left join school_info on ohrigei.group.school_ID = school_info.id
                 left join application_type on application_type.id = delegate.application_type_ID
                 left join application_status on application_status.id = delegate.application_status_ID
        WHERE ohrigei.delegate.role_ID = 1
          AND user.enable_login = 1
          AND `user`.role_ID = 2
    </select>
    <insert id="addGroup">
        INSERT into `group`(school_ID, head_delegate_ID, group_size)
        VALUES (#{param1},#{param2},#{param3})
    </insert>
    <select id="queryGroupById" resultMap="Group">
        SELECT `group`.id, school_ID, head_delegate_ID, group_size, school_name, name
        FROM `group`
                 LEFT JOIN delegate d on `group`.head_delegate_ID = d.id
                 LEFT JOIN user u on d.id = u.id
                 LEFT JOIN school_info si on `group`.school_ID = si.id
        WHERE `group`.id=#{id}
    </select>
</mapper>