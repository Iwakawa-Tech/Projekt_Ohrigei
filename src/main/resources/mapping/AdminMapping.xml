<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.dlufl.ohrigei.dao.AdminDao">
    <resultMap id="Delegate" type="edu.dlufl.ohrigei.model.Delegate">
        <result column="id" property="ID"/>
        <result column="name" property="name"/>
        <result column="enable_login" property="enable_Login"/>
        <result column="school_name" property="schoolName"/>
        <result column="application_type" property="applicationType"/>
        <result column="application_status_text" property="applicationStatus"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
        <result column="group_ID" property="groupID"/>
        <result column="application_status_ID" property="applicationStatusID"/>
    </resultMap>
    <resultMap id="Group" type="edu.dlufl.ohrigei.model.Group">
        <result column="id" property="id"/>
        <result column="school_ID" property="schoolID"/>
        <result column="school_name" property="schoolName"/>
        <result column="head_delegate_ID" property="headDelegateID"/>
        <result column="name" property="headDelegateName"/>
        <result column="group_size" property="groupSize"/>
    </resultMap>
    <resultMap id="Admin" type="edu.dlufl.ohrigei.model.Admin">
        <result column="name" property="name"/>
        <result column="title" property="title"/>
        <result column="role_AG" property="role_AG"/>
        <result column="role_AD" property="role_AD"/>
        <result column="role_D" property="role_D"/>
        <result column="role_F" property="role_F"/>
        <result column="role_L" property="role_L"/>
        <result column="role_SG" property="role_SG"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
        <result column="committee_name" property="committeeName"/>
    </resultMap>
    <resultMap id="Committee" type="edu.dlufl.ohrigei.model.Committee">
        <result column="id" property="id"/>
        <result column="committee_name" property="committeeName"/>
        <result column="seat_width" property="seatWidth"/>
        <result column="chairman_name" property="chairmanName"/>
        <result column="name" property="chairmanName"/>
        <result column="chairman_ID" property="chairmanID"/>
    </resultMap>
    <resultMap id="School" type="edu.dlufl.ohrigei.model.School">
        <result column="id" property="id"/>
        <result column="school_name" property="schoolName"/>
        <result column="school_name_EN" property="schoolNameEN"/>
        <result column="school_type" property="schoolType"/>
        <result column="school_address" property="schoolAddress"/>
        <result column="size" property="size"/>
        <result column="club_ID" property="clubID"/>
    </resultMap>
    <resultMap id="SchoolType" type="edu.dlufl.ohrigei.model.SchoolType">
        <result column="id" property="id"/>
        <result column="school_type" property="schoolType"/>
    </resultMap>
    <resultMap id="Seat" type="edu.dlufl.ohrigei.model.Seat">
        <result column="id" property="id"/>
        <result column="seat_name" property="seatName"/>
        <result column="committee_ID" property="committeeID"/>
        <result column="committee_name" property="committeeName"/>
        <result column="seat_difficulty" property="seatDifficulty"/>
    </resultMap>
    <resultMap id="ApplicationStatus" type="edu.dlufl.ohrigei.model.ApplicationStatus">
        <result column="id" property="id"/>
        <result column="application_status_text" property="applicationStatusText"/>
        <result column="application_status_text_en" property="applicationStatusTextEN"/>
    </resultMap>
    <resultMap id="Interview" type="edu.dlufl.ohrigei.model.Interview">
        <result column="id" property="id"/>
        <result column="admin_id" property="adminID"/>
        <result column="date" property="date"/>
        <result column="interview_point" property="interviewPoint"/>
        <result column="interview_status" property="interviewStatus"/>
        <result column="comment" property="comment"/>
    </resultMap>
    <!--    select-->
    <select id="queryAllMember" resultMap="Delegate">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               ohrigei.user.enable_login,
               ohrigei.user.email,
               ohrigei.user.phone,
               ohrigei.delegate.group_ID,
               ohrigei.school_info.school_name,
               ohrigei.application_type.application_type,
               ohrigei.application_status.application_status_text
        FROM ohrigei.delegate
                 left join user on delegate.id = ohrigei.user.id
                 left join `group` on delegate.group_ID = `group`.id
                 left join school_info on ohrigei.group.school_ID = school_info.id
                 left join application_type on application_type.id = delegate.application_type_ID
                 left join application_status on application_status.id = delegate.application_status_ID
        WHERE ohrigei.delegate.role_ID = #{type}
          AND `user`.role_ID = 2
    </select>
    <select id="queryMemberById" resultMap="Delegate">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               ohrigei.user.enable_login,
               ohrigei.user.email,
               ohrigei.user.phone,
               ohrigei.delegate.group_ID,
               ohrigei.school_info.school_name,
               ohrigei.application_type.application_type,
               ohrigei.application_status.application_status_text
        FROM ohrigei.delegate
                 left join user on delegate.id = ohrigei.user.id
                 left join `group` on delegate.group_ID = `group`.id
                 left join school_info on ohrigei.group.school_ID = school_info.id
                 left join application_type on application_type.id = delegate.application_type_ID
                 left join application_status on application_status.id = delegate.application_status_ID
        WHERE `user`.id = #{id}
    </select>
    <select id="queryAllGroup" resultMap="Group">
        SELECT `group`.id, school_ID, head_delegate_ID, group_size, school_name, name
        FROM `group`
                 LEFT JOIN delegate d on `group`.head_delegate_ID = d.id
                 LEFT JOIN user u on d.id = u.id
                 LEFT JOIN school_info si on `group`.school_ID = si.id
        WHERE `group`.delete_status = 0
    </select>
    <select id="queryAllAdmin" resultMap="Admin">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               admin.title,
               ohrigei.committee.committee_name,
               ohrigei.admin.role_AG,
               ohrigei.admin.role_AD,
               ohrigei.admin.role_D,
               ohrigei.admin.role_F,
               ohrigei.admin.role_L,
               ohrigei.admin.role_SG
        from ohrigei.user
                 LEFT JOIN ohrigei.admin ON ohrigei.user.id = admin.id
                 LEFT JOIN ohrigei.committee ON ohrigei.admin.committee_ID = ohrigei.committee.id
        where role_ID = 1
    </select>
    <select id="queryAllCommittee" resultMap="Committee">
        SELECT committee.id, committee.committee_name, seat_width, ohrigei.user.name, chairman_ID
        FROM committee
                 left join user on chairman_ID = user.id
    </select>
    <select id="queryCommitteeIDAndName" resultMap="Committee">
        SELECT id, committee_name
        FROM committee
    </select>
    <select id="emailCheck" resultType="string">
        SELECT ohrigei.user.email
        from ohrigei.user
        where email = #{email}
    </select>
    <select id="adminDetail" resultMap="Admin">
        SELECT ohrigei.user.name,
               admin.title,
               ohrigei.committee.committee_name,
               ohrigei.admin.role_AG,
               ohrigei.admin.role_AD,
               ohrigei.admin.role_D,
               ohrigei.admin.role_F,
               ohrigei.admin.role_L,
               ohrigei.admin.role_SG
        from ohrigei.user
                 LEFT JOIN ohrigei.admin ON ohrigei.user.id = admin.id
                 LEFT JOIN ohrigei.committee ON ohrigei.admin.committee_ID = ohrigei.committee.id
        where user.id = #{id}
    </select>
    <select id="countDelegate" resultType="int">
        SELECT count(*)
        from ohrigei.delegate
        where role_ID = #{roleId}
    </select>
    <select id="countSeatByCommitteeID" resultType="int">
        SELECT count(*)
        FROM seat
        WHERE committee_ID = #{committeeID}
    </select>
    <select id="committeeWidthSizeGet" resultType="int">
        SELECT seat_width
        FROM committee
        WHERE id = #{committeeID}
    </select>
    <select id="queryAllSchool" resultMap="School">
        SELECT school_info.id, school_name, school_name_EN, school_address, size, club_ID, school_type
        FROM school_info
                 LEFT JOIN school_type st on school_info.school_type_ID = st.id
    </select>
    <select id="queryMemberAbleToUse" resultMap="Delegate">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               ohrigei.user.email,
               ohrigei.user.phone,
               ohrigei.school_info.school_name,
               ohrigei.application_type.application_type,
               ohrigei.application_status.application_status_text
        FROM ohrigei.delegate
                 left join user on delegate.id = ohrigei.user.id
                 left join `group` on delegate.group_ID = `group`.id
                 left join school_info on ohrigei.group.school_ID = school_info.id
                 left join application_type on application_type.id = delegate.application_type_ID
                 left join application_status on application_status.id = delegate.application_status_ID
        WHERE ohrigei.delegate.role_ID = 1
          AND user.enable_login = 1
          AND `user`.role_ID = 2
    </select>
    <select id="getInsertID" resultType="int">
        select ohrigei.user.id
        from ohrigei.user
        where email = #{email}
    </select>
    <select id="queryGroupById" resultMap="Group">
        SELECT `group`.id, school_ID, head_delegate_ID, group_size, school_name, name
        FROM `group`
                 LEFT JOIN delegate d on `group`.head_delegate_ID = d.id
                 LEFT JOIN user u on d.id = u.id
                 LEFT JOIN school_info si on `group`.school_ID = si.id
        WHERE `group`.id = #{id}
    </select>
    <select id="queryAllSchoolType" resultMap="SchoolType">
        select *
        from school_type
    </select>
    <select id="queryAdminIDAndName" resultMap="Admin">
        SELECT ohrigei.user.id, name
        FROM user
        WHERE role_ID = 1
    </select>
    <select id="queryAllSeat" resultMap="Seat">
        SELECT seat.id, seat_name, committee_ID, seat_difficulty, committee_name
        FROM seat,
             committee
        WHERE committee_ID = committee.id
    </select>
    <select id="queryAllApplicationStatus" resultMap="ApplicationStatus">
        SELECT *
        FROM application_status
    </select>
    <select id="queryAdminCanInterview" resultMap="Admin">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               admin.title,
               ohrigei.committee.committee_name,
               ohrigei.admin.role_AG,
               ohrigei.admin.role_AD,
               ohrigei.admin.role_D,
               ohrigei.admin.role_F,
               ohrigei.admin.role_L,
               ohrigei.admin.role_SG
        from ohrigei.user
                 LEFT JOIN ohrigei.admin ON ohrigei.user.id = admin.id
                 LEFT JOIN ohrigei.committee ON ohrigei.admin.committee_ID = ohrigei.committee.id
        where role_ID = 1
          AND (admin.role_AD = 1 OR admin.role_AG = 1)
    </select>
    <select id="queryDelegate" resultMap="Delegate">
        SELECT ohrigei.user.id,
               ohrigei.user.name,
               ohrigei.user.enable_login,
               ohrigei.user.email,
               ohrigei.user.phone,
               ohrigei.delegate.group_ID,
               ohrigei.school_info.school_name,
               ohrigei.application_type.application_type,
               ohrigei.application_status.application_status_text
        FROM ohrigei.delegate
                 left join user on delegate.id = ohrigei.user.id
                 left join `group` on delegate.group_ID = `group`.id
                 left join school_info on ohrigei.group.school_ID = school_info.id
                 left join application_type on application_type.id = delegate.application_type_ID
                 left join application_status on application_status.id = delegate.application_status_ID
        WHERE ohrigei.delegate.role_ID = 1
          AND user.id not IN (SELECT id from interview_info)
    </select>
    <select id="queryAllInterview" resultMap="Interview">
        SELECT *
        FROM interview_info
    </select>
    <select id="getNameByID" resultType="string" >
        SELECT name
        FROM user
        where id = #{id}
    </select>
    <select id="queryInterviewUndone" resultMap="Interview">
        SELECT *
        FROM interview_info
        where interview_status = #{interviewStatus}
    </select>
    <select id="queryInterviewAssignToMe" resultMap="Interview">
        SELECT *
        FROM interview_info
        WHERE admin_id = #{id}
    </select>
    <select id="queryInterviewAssignToMeDoneOrUndone" resultMap="Interview">
        SELECT *
        FROM interview_info
        WHERE admin_id = #{param1}
          AND interview_status = #{param2}
    </select>
    <!--    insert-->

    <insert id="addAdminStep1" parameterType="edu.dlufl.ohrigei.model.Admin">
        insert into ohrigei.user(name, email, password, phone, role_ID)
        values (#{name}, #{email}, #{password}, #{phone}, 1)
    </insert>
    <insert id="addAdminStep2" parameterType="edu.dlufl.ohrigei.model.Admin">
        insert into ohrigei.admin(id, title, role_AG, role_AD, role_D, role_L, role_F, role_SG)
        VALUES (#{id}, #{title}, #{role_AG}, #{role_AD}, #{role_D}, #{role_L}, #{role_F}, #{role_SG})
    </insert>
    <insert id="addGroup">
        INSERT into `group`(school_ID, head_delegate_ID, group_size)
        VALUES (#{param1}, #{param2}, #{param3})
    </insert>
    <insert id="addSchool">
        insert into school_info(school_name, school_name_EN, school_type_ID, school_address, size)
        VALUES (#{param1}, #{param2}, #{param4}, #{param3}, #{param5})
    </insert>
    <insert id="addCommittee">
        INSERT INTO committee(committee_name, seat_width, chairman_ID)
        VALUES (#{param1}, #{param2}, #{param3})
    </insert>
    <insert id="addSeat">
        INSERT INTO seat(seat_name, committee_ID, seat_difficulty)
        VALUES (#{param1}, #{param2}, #{param3})
    </insert>
    <insert id="addInterview">
        INSERT INTO interview_info(id, admin_id, date)
        VALUES (#{param1}, #{param2}, #{param3})
    </insert>
    <!--    update-->

    <update id="modifyGroup">
        UPDATE `ohrigei`.`group`
        SET `school_ID`        = #{param1},
            `head_delegate_ID` = #{param2},
            `group_size`       = #{param3}
        WHERE `id` = #{param4}
    </update>
    <update id="deleteGroup">
        UPDATE `ohrigei`.`group`
        SET `group`.delete_status=1
        WHERE `id` = #{groupID}
    </update>
    <update id="modifyLoginStatusById">
        UPDATE `ohrigei`.`user`
        SET `user`.enable_login=#{param2}
        WHERE `id` = #{param1}
    </update>
    <update id="modifyApplicationStatus">
        UPDATE delegate
        SET application_status_ID=#{param2}
        WHERE `id` = #{param1}
    </update>
</mapper>